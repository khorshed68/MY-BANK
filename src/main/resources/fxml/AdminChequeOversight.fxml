<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.mybank.controllers.AdminChequeOversightController"
            prefHeight="900.0" prefWidth="1500.0"
            stylesheets="@../css/style.css">

    <!-- Header -->
    <top>
        <VBox styleClass="header" alignment="CENTER" spacing="10">
            <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
            
            <Label text="Admin - Cheque System Oversight" styleClass="header-title">
                <font><Font name="Arial Bold" size="28"/></font>
            </Label>
            
            <HBox spacing="10" alignment="CENTER">
                <Button text="Refresh All Data" onAction="#handleRefresh" styleClass="primary-button"/>
                <Button text="Export Report" onAction="#handleExportReport" styleClass="secondary-button"/>
                <Button text="Back to Dashboard" onAction="#handleBackToDashboard" styleClass="secondary-button"/>
            </HBox>
        </VBox>
    </top>

    <!-- Main Content -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
            
            <!-- Overview Tab -->
            <Tab text="Overview &amp; Statistics">
                <ScrollPane fitToWidth="true">
                    <VBox spacing="25">
                        <padding><Insets top="25" right="25" bottom="25" left="25"/></padding>
                        
                        <Label text="System Overview" styleClass="section-title">
                            <font><Font name="Arial Bold" size="20"/></font>
                        </Label>
                        
                        <!-- Cheque Book Statistics -->
                        <VBox spacing="15" style="-fx-background-color: #f5f5f5; -fx-padding: 20; -fx-border-radius: 10;">
                            <Label text="Cheque Book Statistics" style="-fx-font-weight: bold; -fx-font-size: 16;"/>
                            <GridPane hgap="30" vgap="15">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="33"/>
                                    <ColumnConstraints percentWidth="33"/>
                                    <ColumnConstraints percentWidth="33"/>
                                </columnConstraints>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="0" GridPane.rowIndex="0"
                                      style="-fx-background-color: #2196f3; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Total Cheque Books" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="totalBooksLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="1" GridPane.rowIndex="0"
                                      style="-fx-background-color: #ff9800; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Pending Approval" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="pendingBooksLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="2" GridPane.rowIndex="0"
                                      style="-fx-background-color: #4caf50; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Active Books" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="activeBooksLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                            </GridPane>
                        </VBox>
                        
                        <!-- Cheque Statistics -->
                        <VBox spacing="15" style="-fx-background-color: #f5f5f5; -fx-padding: 20; -fx-border-radius: 10;">
                            <Label text="Cheque Processing Statistics" style="-fx-font-weight: bold; -fx-font-size: 16;"/>
                            <GridPane hgap="30" vgap="15">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="33"/>
                                    <ColumnConstraints percentWidth="33"/>
                                    <ColumnConstraints percentWidth="33"/>
                                </columnConstraints>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="0" GridPane.rowIndex="0"
                                      style="-fx-background-color: #607d8b; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Total Cheques Issued" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="totalChequesLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="1" GridPane.rowIndex="0"
                                      style="-fx-background-color: #4caf50; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Cleared Cheques" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="clearedChequesLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="2" GridPane.rowIndex="0"
                                      style="-fx-background-color: #f44336; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Bounced Cheques" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="bouncedChequesLabel" text="0" 
                                           style="-fx-text-fill: white; -fx-font-size: 36; -fx-font-weight: bold;"/>
                                </VBox>
                            </GridPane>
                        </VBox>
                        
                        <!-- Financial Statistics -->
                        <VBox spacing="15" style="-fx-background-color: #f5f5f5; -fx-padding: 20; -fx-border-radius: 10;">
                            <Label text="Financial Statistics" style="-fx-font-weight: bold; -fx-font-size: 16;"/>
                            <GridPane hgap="30" vgap="15">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="50"/>
                                    <ColumnConstraints percentWidth="50"/>
                                </columnConstraints>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="0" GridPane.rowIndex="0"
                                      style="-fx-background-color: #00bcd4; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Total Amount Cleared" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="totalAmountClearedLabel" text="TAKA 0.00" 
                                           style="-fx-text-fill: white; -fx-font-size: 28; -fx-font-weight: bold;"/>
                                </VBox>
                                
                                <VBox spacing="5" alignment="CENTER" GridPane.columnIndex="1" GridPane.rowIndex="0"
                                      style="-fx-background-color: #9c27b0; -fx-padding: 25; -fx-background-radius: 10;">
                                    <Label text="Total Amount Bounced" style="-fx-text-fill: white; -fx-font-size: 14;"/>
                                    <Label fx:id="totalAmountBouncedLabel" text="TAKA 0.00" 
                                           style="-fx-text-fill: white; -fx-font-size: 28; -fx-font-weight: bold;"/>
                                </VBox>
                            </GridPane>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
            <!-- All Cheque Books Tab -->
            <Tab text="All Cheque Books">
                <VBox spacing="15">
                    <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                    
                    <Label text="Cheque Books Management" styleClass="section-title">
                        <font><Font name="Arial Bold" size="18"/></font>
                    </Label>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Search:"/>
                        <TextField fx:id="searchBookField" promptText="Book number, account, or customer..." prefWidth="250"/>
                        <Button text="Search" onAction="#handleSearchBooks" styleClass="secondary-button"/>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <Label text="Status:"/>
                        <ComboBox fx:id="bookStatusFilter" prefWidth="120"/>
                        
                        <Label text="From:"/>
                        <DatePicker fx:id="bookFromDatePicker" prefWidth="130"/>
                        
                        <Label text="To:"/>
                        <DatePicker fx:id="bookToDatePicker" prefWidth="130"/>
                        
                        <Button text="Filter" onAction="#handleSearchBooks" styleClass="secondary-button"/>
                    </HBox>
                    
                    <TableView fx:id="allBooksTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="bookNumberCol" text="Book Number" prefWidth="120"/>
                            <TableColumn fx:id="accountCol" text="Account" prefWidth="130"/>
                            <TableColumn fx:id="customerCol" text="Customer" prefWidth="150"/>
                            <TableColumn fx:id="statusCol" text="Status" prefWidth="100"/>
                            <TableColumn fx:id="totalLeavesCol" text="Total Leaves" prefWidth="90"/>
                            <TableColumn fx:id="remainingLeavesCol" text="Remaining" prefWidth="90"/>
                            <TableColumn fx:id="requestDateCol" text="Request Date" prefWidth="140"/>
                            <TableColumn fx:id="approvedByCol" text="Approved By" prefWidth="130"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </Tab>
            
            <!-- All Cheques Tab -->
            <Tab text="All Cheques">
                <VBox spacing="15">
                    <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                    
                    <Label text="All Cheques - Complete History" styleClass="section-title">
                        <font><Font name="Arial Bold" size="18"/></font>
                    </Label>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Search:"/>
                        <TextField fx:id="searchChequeField" promptText="Cheque number, account, customer, or payee..." prefWidth="300"/>
                        <Button text="Search" onAction="#handleSearchCheques" styleClass="secondary-button"/>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <Label text="Status:"/>
                        <ComboBox fx:id="chequeStatusFilter" prefWidth="130"/>
                        
                        <Label text="From:"/>
                        <DatePicker fx:id="chequeFromDatePicker" prefWidth="130"/>
                        
                        <Label text="To:"/>
                        <DatePicker fx:id="chequeToDatePicker" prefWidth="130"/>
                        
                        <Button text="Filter" onAction="#handleSearchCheques" styleClass="secondary-button"/>
                    </HBox>
                    
                    <TableView fx:id="allChequesTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="chequeNumberCol" text="Cheque Number" prefWidth="130"/>
                            <TableColumn fx:id="chequeAccountCol" text="Account" prefWidth="120"/>
                            <TableColumn fx:id="chequeCustomerCol" text="Customer" prefWidth="130"/>
                            <TableColumn fx:id="chequeAmountCol" text="Amount (TAKA)" prefWidth="100"/>
                            <TableColumn fx:id="chequePayeeCol" text="Payee" prefWidth="130"/>
                            <TableColumn fx:id="chequeStatusCol" text="Status" prefWidth="100"/>
                            <TableColumn fx:id="chequeIssueDateCol" text="Issue Date" prefWidth="100"/>
                            <TableColumn fx:id="chequeClearanceDateCol" text="Clearance Date" prefWidth="140"/>
                            <TableColumn fx:id="bouncedReasonCol" text="Bounce Reason" prefWidth="150"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </Tab>
            
            <!-- Transaction History Tab -->
            <Tab text="Transaction History">
                <VBox spacing="15">
                    <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                    
                    <Label text="Complete Transaction Audit Trail" styleClass="section-title">
                        <font><Font name="Arial Bold" size="18"/></font>
                    </Label>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Type:"/>
                        <ComboBox fx:id="txTypeFilter" prefWidth="120"/>
                        
                        <Label text="From:"/>
                        <DatePicker fx:id="txFromDatePicker" prefWidth="130"/>
                        
                        <Label text="To:"/>
                        <DatePicker fx:id="txToDatePicker" prefWidth="130"/>
                        
                        <Button text="Filter" onAction="#handleFilterTransactions" styleClass="secondary-button"/>
                    </HBox>
                    
                    <TableView fx:id="transactionTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="txChequeNumCol" text="Cheque Number" prefWidth="130"/>
                            <TableColumn fx:id="txAccountCol" text="Account" prefWidth="120"/>
                            <TableColumn fx:id="txTypeCol" text="Type" prefWidth="90"/>
                            <TableColumn fx:id="txOldStatusCol" text="Old Status" prefWidth="100"/>
                            <TableColumn fx:id="txNewStatusCol" text="New Status" prefWidth="100"/>
                            <TableColumn fx:id="txAmountCol" text="Amount (TAKA)" prefWidth="100"/>
                            <TableColumn fx:id="txDateCol" text="Date &amp; Time" prefWidth="150"/>
                            <TableColumn fx:id="txPerformedByCol" text="Performed By" prefWidth="130"/>
                            <TableColumn fx:id="txUserTypeCol" text="User Type" prefWidth="90"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </Tab>
            
            <!-- Eligibility Settings Tab -->
            <Tab text="Eligibility Settings">
                <VBox spacing="20">
                    <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                    
                    <Label text="Cheque Book Eligibility Configuration" styleClass="section-title">
                        <font><Font name="Arial Bold" size="18"/></font>
                    </Label>
                    
                    <HBox spacing="30">
                        <!-- Input Form -->
                        <VBox spacing="15" HBox.hgrow="ALWAYS"
                              style="-fx-background-color: #f9f9f9; -fx-padding: 20; -fx-border-color: #ccc; -fx-border-radius: 5;">
                            <Label text="Add/Update Eligibility Criteria" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                            
                            <GridPane hgap="15" vgap="12">
                                <columnConstraints>
                                    <ColumnConstraints minWidth="180" prefWidth="180"/>
                                    <ColumnConstraints minWidth="200" prefWidth="250"/>
                                </columnConstraints>
                                
                                <Label text="Account Type: *" GridPane.columnIndex="0" GridPane.rowIndex="0"
                                       style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="accountTypeCombo" promptText="Select account type"
                                         GridPane.columnIndex="1" GridPane.rowIndex="0" prefWidth="250"/>
                                
                                <Label text="Minimum Balance (TAKA): *" GridPane.columnIndex="0" GridPane.rowIndex="1"
                                       style="-fx-font-weight: bold;"/>
                                <TextField fx:id="minBalanceField" promptText="e.g., 5000.00"
                                          GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                                
                                <Label text="Min Account Age (Days): *" GridPane.columnIndex="0" GridPane.rowIndex="2"
                                       style="-fx-font-weight: bold;"/>
                                <TextField fx:id="minAccountAgeField" promptText="e.g., 90"
                                          GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                                
                                <Label text="Max Books Per Year: *" GridPane.columnIndex="0" GridPane.rowIndex="3"
                                       style="-fx-font-weight: bold;"/>
                                <TextField fx:id="maxBooksPerYearField" promptText="e.g., 4"
                                          GridPane.columnIndex="1" GridPane.rowIndex="3"/>
                                
                                <Label text="Leaves Per Book: *" GridPane.columnIndex="0" GridPane.rowIndex="4"
                                       style="-fx-font-weight: bold;"/>
                                <TextField fx:id="leavesPerBookField" promptText="e.g., 25"
                                          GridPane.columnIndex="1" GridPane.rowIndex="4"/>
                                
                                <Label text="Active: " GridPane.columnIndex="0" GridPane.rowIndex="5"
                                       style="-fx-font-weight: bold;"/>
                                <CheckBox fx:id="isActiveCheck" text="Enable this criteria" selected="true"
                                         GridPane.columnIndex="1" GridPane.rowIndex="5"/>
                            </GridPane>
                            
                            <HBox spacing="10">
                                <Button fx:id="saveEligibilityBtn" text="Save Criteria" 
                                        onAction="#handleSaveEligibility" 
                                        styleClass="primary-button" prefWidth="130"/>
                                <Button text="Clear Form" 
                                        onAction="#handleRefresh"
                                        styleClass="secondary-button" prefWidth="130"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Existing Criteria Table -->
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="Current Eligibility Criteria" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                            
                            <TableView fx:id="eligibilityTable" VBox.vgrow="ALWAYS" onMouseClicked="#handleLoadEligibility">
                                <columns>
                                    <TableColumn fx:id="eligAccountTypeCol" text="Account Type" prefWidth="120"/>
                                    <TableColumn fx:id="eligMinBalanceCol" text="Min Balance" prefWidth="100"/>
                                    <TableColumn fx:id="eligMinAgeCol" text="Min Age (Days)" prefWidth="100"/>
                                    <TableColumn fx:id="eligMaxBooksCol" text="Max Books/Yr" prefWidth="100"/>
                                    <TableColumn fx:id="eligLeavesCol" text="Leaves/Book" prefWidth="100"/>
                                    <TableColumn fx:id="eligActiveCol" text="Active" prefWidth="70"/>
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                </columnResizePolicy>
                            </TableView>
                            
                            <HBox spacing="10">
                                <Button fx:id="deleteEligibilityBtn" text="Delete Selected" 
                                        onAction="#handleDeleteEligibility" 
                                        styleClass="danger-button" prefWidth="130"/>
                                <Label text="Click on a row to edit" style="-fx-font-size: 11; -fx-text-fill: #666;"/>
                            </HBox>
                        </VBox>
                    </HBox>
                    
                    <VBox spacing="10" style="-fx-background-color: #e3f2fd; -fx-padding: 15; -fx-border-color: #2196f3; -fx-border-radius: 5;">
                        <Label text="Information:" style="-fx-font-weight: bold; -fx-text-fill: #1565c0;"/>
                        <Label text="• These criteria determine which customers are eligible to request cheque books" wrapText="true"/>
                        <Label text="• All conditions must be met for a customer to be eligible" wrapText="true"/>
                        <Label text="• Changes take effect immediately for new requests" wrapText="true"/>
                        <Label text="• Click on a table row to load it for editing" wrapText="true"/>
                    </VBox>
                </VBox>
            </Tab>
        </TabPane>
    </center>
</BorderPane>
